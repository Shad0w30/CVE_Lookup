<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVE Lookup</title>
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fcfdfe; color: #334155; }

        /* Modern Pastel Link Cards (Purple) */
        .research-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid #f3e8ff;
            background: #faf5ff;
            color: #7e22ce;
        }
        .research-card:hover {
            transform: translateY(-2px);
            border-color: #d8b4fe;
            background: #f3e8ff;
            box-shadow: 0 4px 20px -2px rgba(126, 34, 206, 0.1);
        }

        /* Sleek Loading Progress */
        .progress-bar-fill {
            transition: width 0.4s ease-out;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        }

        /* Modern Pastel Severities & Tabs */
        .theme-total { background-color: #f1f5f9; color: #475569; border-color: #e2e8f0; }
        .theme-critical { background-color: #fee2e2; color: #991b1b; border-color: #fecaca; }
        .theme-high { background-color: #ffedd5; color: #9a3412; border-color: #fed7aa; }
        .theme-medium { background-color: #fef3c7; color: #92400e; border-color: #fde68a; }
        .theme-epss { background-color: #eff6ff; color: #1d4ed8; border-color: #dbeafe; }
        .theme-kev { background-color: #f5f3ff; color: #5b21b6; border-color: #ddd6fe; }

        .btn-analyze { background-color: #2563eb; transition: all 0.2s; }
        .btn-analyze:hover { background-color: #1d4ed8; transform: translateY(-1px); }
        .btn-refresh { background-color: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; }
        .btn-refresh:hover { background-color: #e2e8f0; }

        .stat-card { border-width: 1px; border-radius: 1.25rem; transition: transform 0.2s, box-shadow 0.2s; }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="min-h-screen pb-24">
    <div class="container mx-auto p-6 max-w-6xl">

        <div class="flex items-center mb-10 mt-4">
            <div class="p-3 bg-blue-600 rounded-2xl shadow-lg shadow-blue-100 mr-4">
                <i class="fas fa-shield-halved text-white text-2xl"></i>
            </div>
            <h1 class="text-3xl font-extrabold tracking-tight text-slate-900">
                CVE Lookup <span class="text-slate-300 text-sm font-medium ml-1">v0.1</span>
            </h1>
        </div>

        <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 p-8 mb-8">
            <div class="flex justify-between items-center mb-4">
                <label class="text-xs font-black text-slate-400 uppercase tracking-widest">Target CVE IDs:</label>
                <div id="exportGroup" class="hidden flex gap-2">
                    <button id="downloadExcel" class="text-[10px] font-bold bg-white text-green-600 px-3 py-1.5 rounded-lg border border-green-100 hover:bg-green-50 transition">
                        <i class="fas fa-file-excel mr-1"></i> EXCEL
                    </button>
                    <button id="downloadJson" class="text-[10px] font-bold bg-white text-purple-600 px-3 py-1.5 rounded-lg border border-purple-100 hover:bg-purple-50 transition">
                        <i class="fas fa-code mr-1"></i> JSON
                    </button>
                </div>
            </div>

            <textarea id="cveInput" rows="3"
                class="w-full p-5 bg-slate-50 border border-slate-100 rounded-2xl focus:ring-4 focus:ring-blue-50 focus:bg-white transition-all outline-none text-slate-600 font-mono text-sm mb-6"
                placeholder="CVE-2021-44228, CVE-2023-23397..."></textarea>

            <div class="flex items-center gap-4">
                <button id="searchButton" class="btn-analyze flex-grow text-white py-4 rounded-2xl font-bold flex items-center justify-center shadow-lg shadow-blue-100">
                    <i class="fas fa-magnifying-glass mr-2 text-sm"></i> Analyze CVEs
                </button>
                <button id="refreshButton" class="btn-refresh p-4 rounded-2xl flex items-center justify-center transition">
                    <i class="fas fa-rotate-right"></i>
                </button>
            </div>

            <div id="loading" class="hidden mt-8">
                <div class="flex justify-between items-end mb-2">
                    <div class="flex items-center">
                        <i class="fas fa-circle-notch fa-spin text-blue-500 mr-3"></i>
                        <span id="loadingStatus" class="text-sm font-bold text-slate-700">Initializing Scan...</span>
                    </div>
                    <span id="loadingCount" class="text-[10px] font-black text-slate-400 uppercase tracking-tighter">0 / 0</span>
                </div>
                <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                    <div id="progressBar" class="progress-bar-fill h-full w-0"></div>
                </div>
            </div>
        </div>

        <div id="summaryStats" class="hidden grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-10">
            <div class="stat-card p-5 text-center theme-total">
                <p class="text-[10px] font-black uppercase tracking-widest opacity-60 mb-1">Total</p>
                <p id="stat-total" class="text-2xl font-extrabold">0</p>
            </div>
            <div class="stat-card p-5 text-center theme-critical">
                <p class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-1">Critical</p>
                <p id="stat-critical" class="text-2xl font-extrabold">0</p>
            </div>
            <div class="stat-card p-5 text-center theme-high">
                <p class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-1">High</p>
                <p id="stat-high" class="text-2xl font-extrabold">0</p>
            </div>
            <div class="stat-card p-5 text-center theme-medium">
                <p class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-1">Medium</p>
                <p id="stat-medium" class="text-2xl font-extrabold">0</p>
            </div>
            <div class="stat-card p-5 text-center theme-epss">
                <p class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-1">EPSS > 10%</p>
                <p id="stat-epss-high" class="text-2xl font-extrabold">0</p>
            </div>
            <div class="stat-card p-5 text-center theme-kev">
                <p class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-1">CISA KEV</p>
                <p id="stat-kev" class="text-2xl font-extrabold">0</p>
            </div>
        </div>

        <div id="tableContainer" class="hidden bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
            <table class="min-w-full divide-y divide-slate-50">
                <thead class="bg-slate-50/50">
                    <tr class="text-[10px] font-black text-slate-400 uppercase tracking-widest">
                        <th class="px-8 py-5 text-left">CVE Identification</th>
                        <th class="px-8 py-5 text-left">Impacted Product</th>
                        <th class="px-8 py-5 text-left">Exploit Prob.</th>
                        <th class="px-8 py-5 text-center">Severity</th>
                    </tr>
                </thead>
                <tbody id="resultsTable" class="divide-y divide-slate-50"></tbody>
            </table>
        </div>
    </div>

    <script>
        let cveData = [];
        const CVE_REGEX = /\bCVE-\d{4}-\d{4,7}\b/gi;

        const THREAT_LINKS = {
            "Wiz Database": id => `https://www.wiz.io/vulnerability-database/cve/${id.toLowerCase()}`,
            "NVD Portal": id => `https://nvd.nist.gov/vuln/detail/${id}`,
            "Snyk Intel": id => `https://snyk.io/vuln/${id}`,
            "GitHub Advisory": id => `https://github.com/advisories?query=${id}`,
            "MITRE AWG": id => `https://cveawg.mitre.org/api/cve/${id}`,
            "Vulners Hub": id => `https://vulners.com/cve/${id}`,
            "CVE.org": id => `https://www.cve.org/CVERecord?id=${id}`,
            "CIRCL.lu": id => `https://cve.circl.lu/cve/${id}`
        };

        async function analyze() {
            const raw = document.getElementById('cveInput').value;
            const matches = [...new Set((raw.match(CVE_REGEX) || []).map(c => c.toUpperCase()))];
            if (matches.length === 0) return alert("Please enter valid CVE IDs.");

            cveData = [];
            const loader = document.getElementById('loading');
            const progress = document.getElementById('progressBar');
            loader.classList.remove('hidden');

            for (let i = 0; i < matches.length; i++) {
                const id = matches[i];
                document.getElementById('loadingStatus').textContent = `Processing ${id}`;
                document.getElementById('loadingCount').textContent = `${i + 1} / ${matches.length}`;
                progress.style.width = `${((i + 1) / matches.length) * 100}%`;

                try {
                    const [nvdRes, epssRes] = await Promise.all([
                        fetch(`https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=${id}`).then(r => r.json()),
                        fetch(`https://api.first.org/data/v1/epss?cve=${id}`).then(r => r.json())
                    ]);

                    const nvd = nvdRes?.vulnerabilities?.[0]?.cve;
                    const m = nvd?.metrics?.cvssMetricV31?.[0]?.cvssData || nvd?.metrics?.cvssMetricV30?.[0]?.cvssData;

                    cveData.push({
                        id,
                        score: m?.baseScore || 0,
                        severity: m?.baseSeverity || 'UNKNOWN',
                        epssRaw: epssRes?.data?.[0]?.epss || 0,
                        epssP: (epssRes?.data?.[0]?.epss * 100).toFixed(2) + '%',
                        desc: nvd?.descriptions?.find(d => d.lang === 'en')?.value || "No detailed description provided.",
                        isKev: !!nvd?.cisaExploitAdd,
                        pkg: nvd?.configurations?.[0]?.nodes?.[0]?.cpeMatch?.[0]?.criteria?.split(':')[4] || 'N/A',
                        refs: nvd?.references?.map(r => r.url) || []
                    });
                } catch (e) { console.error(e); }

                render();
                updateStats();
                if (matches.length > 1) await new Promise(r => setTimeout(r, 600));
            }

            loader.classList.add('hidden');
            document.getElementById('exportGroup').classList.remove('hidden');
            document.getElementById('summaryStats').classList.remove('hidden');
            document.getElementById('tableContainer').classList.remove('hidden');
        }

        function render() {
            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = '';

            cveData.forEach((item, idx) => {
                const row = document.createElement('tr');
                row.className = `cursor-pointer transition-all hover:bg-slate-50/50 ${item.isKev ? 'border-l-4 border-purple-500' : ''}`;
                row.onclick = () => document.getElementById(`detail-${idx}`).classList.toggle('hidden');

                row.innerHTML = `
                    <td class="px-8 py-5">
                        <span class="font-bold text-slate-800">${item.id}</span>
                        ${item.isKev ? '<span class="ml-2 text-[8px] font-black bg-purple-600 text-white px-1.5 py-0.5 rounded-full">CISA KEV</span>' : ''}
                    </td>
                    <td class="px-8 py-5 text-[11px] font-bold text-slate-400 uppercase tracking-tighter">${item.pkg}</td>
                    <td class="px-8 py-5 text-xs font-bold text-blue-500">${item.epssP}</td>
                    <td class="px-8 py-5 text-center">
                        <span class="px-3 py-1 rounded-full text-[10px] font-black inline-block min-w-[90px] ${getSevTheme(item.severity)}">
                            ${item.score} ${item.severity}
                        </span>
                    </td>
                `;

                const detail = document.createElement('tr');
                detail.id = `detail-${idx}`;
                detail.className = 'hidden bg-slate-50/30';
                detail.innerHTML = `
                    <td colspan="4" class="px-10 py-8">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                            <div class="lg:col-span-2">
                                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Vulnerability Summary</h4>
                                <p class="text-sm text-slate-600 leading-relaxed mb-6">${item.desc}</p>
                                <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">Resources & References</h4>
                                <div class="grid grid-cols-1 gap-2">
                                    ${item.refs.slice(0, 4).map(r => `<a href="${r}" target="_blank" class="text-[11px] text-blue-400 hover:text-blue-600 truncate"><i class="fas fa-link mr-2 opacity-40"></i>${r}</a>`).join('')}
                                </div>
                            </div>
                            <div>
                                <h4 class="text-[10px] font-black text-purple-800 uppercase tracking-widest mb-4">Threat Research</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    ${Object.entries(THREAT_LINKS).map(([name, fn]) => `
                                        <a href="${fn(item.id)}" target="_blank" class="research-card p-3 rounded-xl text-[10px] font-bold text-center">
                                            ${name}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
                tbody.appendChild(detail);
            });
        }

        function updateStats() {
            const s = { total: cveData.length, crit: 0, high: 0, med: 0, epss: 0, kev: 0 };
            cveData.forEach(d => {
                if (d.severity === 'CRITICAL') s.crit++;
                if (d.severity === 'HIGH') s.high++;
                if (d.severity === 'MEDIUM') s.med++;
                if (d.epssRaw > 0.1) s.epss++;
                if (d.isKev) s.kev++;
            });
            document.getElementById('stat-total').textContent = s.total;
            document.getElementById('stat-critical').textContent = s.crit;
            document.getElementById('stat-high').textContent = s.high;
            document.getElementById('stat-medium').textContent = s.med;
            document.getElementById('stat-epss-high').textContent = s.epss;
            document.getElementById('stat-kev').textContent = s.kev;
        }

        function getSevTheme(s) {
            if (s === 'CRITICAL') return 'theme-critical';
            if (s === 'HIGH') return 'theme-high';
            if (s === 'MEDIUM') return 'theme-medium';
            return 'bg-slate-100 text-slate-400';
        }

        document.getElementById('searchButton').onclick = analyze;
        document.getElementById('refreshButton').onclick = () => location.reload();

        document.getElementById('downloadExcel').onclick = () => {
            const ws = XLSX.utils.json_to_sheet(cveData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Analysis");
            XLSX.writeFile(wb, "CVE_Lookup_Report.xlsx");
        };

        document.getElementById('downloadJson').onclick = () => {
            const blob = new Blob([JSON.stringify(cveData, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = "cve_data.json"; a.click();
        };
    </script>
</body>
</html>
